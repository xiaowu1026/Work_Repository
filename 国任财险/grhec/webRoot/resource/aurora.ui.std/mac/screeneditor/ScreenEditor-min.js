(function(){var m=Ext.util.Event,ab=m.prototype;ab.on=ab.addListener;ab.un=ab.removeListener;var al=0,c=0,F={},I,R,X,am,n=Ext.isIE,u=Ext.isIE9||Ext.isIE10||Ext.isIE11,d=false,e,q,H,S=document,D,L,aj,k=Ext.each,t=Ext.get,ak=Math.max,A=Math.min,ao=Math.round,T=new m(),r=new m(),y=new m(),ai=function(ap){ap.stopEvent()},O,h,o,i,l="tab_code",B="parent_tab_code",Z="tab_seq",g="tab_type",b="tab_group",Q="width",W="height",Y="label_width",a="field_width",v="setup_width",s="setup_height",V="margin_width",K="margin_height",ah="tab_desc",j="row_count",M="column_count",U=function(ar,at,aq){if(aq){U(ar,aq)}if(ar&&at&&typeof at=="object"){for(var ap in at){if(Ext.isDefined(at[ap])){ar[ap]=at[ap]}}}return ar},E={id:l,group:b,width:Q,height:W,labelwidth:Y,fieldwidth:a,ismarginwidth:v,ismarginheight:s,marginwidth:V,marginheight:K,title:ah,row:j,column:M},z=function(at,aq,ap){var ar=x.get(at),au={};Ext.iterate(E,function(av,aw){if(Ext.isDefined(ar[av])){au[aw]=ar[av]}});au[g]=G.find(at);au[l]="editor-"+(++al);if(Ext.isDefined(ap)){au[B]=ap;au[v]="ABSOLUTE_WIDTH"}if(at=="TabPanel"){au[b]=++c}au[Z]=aq;return au},p=function(ap){var aq={record:ap,dataset:ap.ds};Ext.iterate(E,function(ar,at){aq[ar]=ap.get(at)});return aq},aa=function(aq,ap,ar){var at=[];Ext.iterate(ap,function(au,av){at.push(au+'="'+av+'"')});return['<div unselectable="on" class="',aq,'" ',at.join(" "),">",ar||"","</div>"].join("")},J=function(ar,ap){if(Ext.isString(ar)){var aq=x.get(ar);proxy={width:aq.ismarginwidth=="MARGIN_WIDTH"&&ap?o-aq.marginwidth:aq.width,height:aq.ismarginheight=="MARGIN_HEIGHT"?i-aq.marginheight:aq.height}}else{var aq=ar.wrap;proxy={width:aq.getWidth(),height:aq.getHeight()}}return proxy},N=function(){var ap;return{start:function(ar,aq){this.end();ap=ar.defer(aq)},end:function(){if(ap){clearTimeout(ap);ap=null}}}}(),G=function(){var ap={TabPanel:"TAB",Form:"FORM",Grid:"GRID",Table:"TABLE",FieldBox:"FIELDBOX",FieldBoxColumn:"FIELDBOXCOLUMN",HBox:"HBOX",VBox:"VBOX"},aq={};Ext.iterate(ap,function(ar,at){aq[at]=ar});return{find:function(ar){return ap[ar]},get:function(ar){return aq[ar]}}}(),x=function(){var ar={width:400,height:200,minwidth:150,minheight:75,marginwidth:50,marginheight:100,resizable:"xy",ismarginwidth:"MARGIN_WIDTH",ismarginheight:"ABSOLUTE_HEIGHT",movable:true,closable:true},aq={TextField:{width:150,height:20,minwidth:50,minheight:20},Box:{labelwidth:120,fieldwidth:280,row:0,column:4,resizable:"",ismarginwidth:"",ismarginheight:""},HBox:{extend:"Box",row:1,column:0},VBox:{extend:"Box",column:1},Form:{extend:"Box",sizable:true},FieldBoxColumn:{extend:"FieldBox",labelminwidth:10},FieldBox:{height:224,extend:"Box"},Grid:{columnminwidth:30},Table:{extend:"Grid"},Tab:{stripwidth:100}};function ap(au){var at=aq[au],av=at.extend;delete at.extend;if(av){at=aq[au]=Ext.apply({},at,ap(av))}return at}return{init:function(){var at={};Ext.iterate(aq,function(au,av){at[au]=Ext.apply({},ap(au),ar)});aq=at},get:function(at){return aq[at]||ar},setOptions:function(au,at){ar=at||ar;aq=au;this.init()}}}(),ae=function(){var ar,ap=false,aq=aa("editor-tip");return{init:function(){ar=ar||new Ext.Template(aq).insertFirst(Ext.getBody(),{},true)},show:function(at,av,au){ar.moveTo(at-this.width()/2,av-this.height()/2).show(au!==false&&!ap);ap=true;return this},hide:function(at){if(ap){ar.hide(at!==false&&{callback:function(){ar.moveTo(-10000,-10000)}});ap=false}return this},log:function(au,at){Ext.isObject(au)?au.appendTo(ar.update("")):ar.update(au);ar.setOpacity(at);return this},width:function(){return ar.getWidth()},height:function(){return ar.getHeight()},isShow:function(){return ap}}}(),af=function(){var ap={};return{put:function(aq){ap[aq.id]=aq},get:function(aq){return ap[aq]},remove:function(aq){delete ap[aq.id]},clear:function(){ap={}}}}(),C=function(){var at,ar,ap=false,aq='<div class="editor-input item-tf item-wrap"><input class="item-textField" style="text-align:center" autocomplete="off" type="input" tabIndex="-1"></input></div>';return new (Ext.extend(Ext.util.Observable,{init:function(){at=at||new Ext.Template(aq).insertFirst(Ext.getBody(),{},true);ar=at.child("input")},show:function(au,av){at.moveTo(au,av).show();ap=true;return this},hide:function(){if(ap){at.hide();ap=false}return this},width:function(au){if(Ext.isDefined(au)){at.setWidth(au);return this}else{return at.getWidth()}},height:function(au){if(Ext.isDefined(au)){at.setHeight(au);return this}else{return at.getHeight()}},isShow:function(){return ap}}))()}(),P=function(){var at,aq=false,ar=aa("screen-editor-proxy editor-wrap"),ap;return new (Ext.extend(Ext.util.Observable,{init:function(){at=at||new Ext.Template(ar).insertFirst(Ext.getBody(),{},true)},show:function(au){var av=this;aq&&av.hide();at.appendTo(ap=au);aq=true;return av},hide:function(){var au=this;Ext.getBody().insertFirst(at);aq=false;au.fireEvent("hide");return au},getWrap:function(){return ap},width:function(au){if(Ext.isDefined(au)){at.setWidth(au);return this}else{return at.getWidth()}},height:function(au){if(Ext.isDefined(au)){at.setHeight(au);return this}else{return at.getHeight()}},isShow:function(){return aq}}))()}(),an=Ext.extend(Ext.util.Observable,{constructor:function(ap){var aq=this;Ext.apply(aq,ap);aq.initComponent(ap);af.put(aq);aq.initOthers();aq.initEvents()},initComponent:function(ap){},initOthers:function(){},initEvents:function(){this.addEvents("resize")},focus:function(){var ap=this;ap.wrap.focus()},blur:function(){this.wrap.blur()},setWidth:function(ap){var aq=this;if(ap==aq.width){return}aq.width=ap;aq.marginwidth=o-ap;aq.wrap.setWidth(ap);aq.fireEvent("resize",aq)},getWidth:function(){return this.width},setMinWidth:function(ap){var aq=this;if(ap==aq.minwidth){return}aq.minwidth=ap;if(ap>aq.width){aq.getRecord().set(Q,ap)}},getMinWidth:function(){return this.minwidth},setHeight:function(ap){var aq=this;if(ap==aq.height){return false}aq.height=ap;aq.marginheight=i-ap;aq.wrap.setHeight(ap);aq.fireEvent("resize",aq)},getHeight:function(){return this.height},setMinHeight:function(ap){var aq=this;if(ap==aq.minheight){return}aq.minheight=ap;if(ap>aq.height){aq.getRecord().set(W,ap)}},getMinHeight:function(){return this.minheight},getRecord:function(){return this.record},destroy:function(){var aq=this,ar=aq.dataset,ap=aq.children;k(ap,function(at){ar.remove(at.getRecord())});af.remove(aq);aq.fireEvent("destroy",aq)}}),f=function(){var at=aa("editor-outline"),ap=aa("drag-icon",{title:"拖动"}),ar=aa("close-icon",{title:"关闭"}),aq=aa("resize-icon",{title:"缩放"}),au=aa("marginsize-icon {cls}",{title:"{title}"});return Ext.extend(an,{constructor:function(av){var aw=this;av.ismarginwidth=av.ismarginwidth=="MARGIN_WIDTH";av.ismarginheight=av.ismarginwidth=="MARGIN_HEIGHT";an.prototype.constructor.call(aw,av);aw.resizable&&aw.onScreenResize(o,i)},initOthers:function(){var av=this;av.initOutline();av.movable&&av.initMove();av.resizable&&av.initResize();av.closable&&av.initClose()},initOutline:function(){this.outline=new Ext.Template(at).insertFirst(this.wrap,{},true)},initMove:function(){this.dragIcon=new Ext.Template(ap).insertFirst(this.wrap,{},true)},initResize:function(){var aw=this,av=aw.ismarginwidth,ax=aw.ismarginheight;aw.resizeIcon=new Ext.Template(aq).insertFirst(aw.wrap,{},true);if(aw.resizable.indexOf("x")!=-1){aw.setupwidthIcon=new Ext.Template(au).insertFirst(aw.wrap,{title:av?"边距宽度":"绝对宽度",cls:av?"marginwidth-icon":"width-icon"},true)}if(aw.resizable.indexOf("y")!=-1){aw.setupheightIcon=new Ext.Template(au).insertFirst(aw.wrap,{title:ax?"边距高度":"绝对高度",cls:ax?"marginheight-icon":"height-icon"},true)}},initClose:function(){this.closeIcon=new Ext.Template(ar).insertFirst(this.wrap,{},true)},initEvents:function(){var av=this;an.prototype.initEvents.call(av);av.addEvents("destroy");av.processListener("on")},processListener:function(av){var aw=this;aw.wrap[av]("focus",aw.onFocus,aw)[av]("blur",aw.onBlur,aw)[av]("click",aw.onClick,aw)[av]("dblclick",aw.onDblClick,aw)[av]("mousedown",aw.onMouseDown,aw)[av]("keydown",aw.onKeyDown,aw)[av]("mouseover",aw.onMouseOver,aw)[av]("mouseout",aw.onMouseOut,aw);r[av](aw.onDropEnd,aw);aw.movable&&aw.dragIcon[av]("mousedown",aw.onMoveStart,aw);if(aw.resizable){aw.resizeIcon[av]("mousedown",aw.onResizeStart,aw);y[av](aw.onScreenResize,aw);if(aw.resizable.indexOf("x")!=-1){aw.setupwidthIcon[av]("click",aw.onSetupWidthClick,aw)[av]("mousedown",ai,aw)}if(aw.resizable.indexOf("y")!=-1){aw.setupheightIcon[av]("click",aw.onSetupHeightClick,aw)[av]("mousedown",ai,aw)}}aw.closable&&aw.closeIcon[av]("click",aw.close,aw)[av]("mousedown",ai,aw)},setupWidth:function(ay){var ax=this,av=ax.setupwidthIcon,aw=ay=="MARGIN_WIDTH";if(ax.ismarginwidth==aw){return false}if(ax.ismarginwidth=aw){av.addClass("marginwidth-icon").removeClass("width-icon").set({title:"边距宽度"});ax.getRecord().set(V,o-ax.width)}else{av.addClass("width-icon").removeClass("marginwidth-icon").set({title:"绝对宽度"})}},setupHeight:function(ay){var aw=this,av=aw.setupheightIcon,ax=ay=="MARGIN_HEIGHT";if(aw.ismarginheight==ax){return false}if(aw.ismarginheight=ax){av.addClass("marginheight-icon").removeClass("height-icon").set({title:"边距高度"});aw.getRecord().set(K,i-aw.height)}else{av.addClass("height-icon").removeClass("marginheight-icon").set({title:"绝对高度"})}},onSetupWidthClick:function(ax,av){var aw=this;aw.getRecord().set(v,aw.ismarginwidth?"ABSOLUTE_WIDTH":"MARGIN_WIDTH")},onSetupHeightClick:function(ax,av){var aw=this;aw.getRecord().set(s,aw.ismarginheight?"ABSOLUTE_HEIGHT":"MARGIN_HEIGHT")},onScreenResize:function(ax,av){var ay=this,aw=ay.getRecord();ay.resizable.indexOf("x")!=-1&&ay.ismarginwidth&&aw.set(Q,ax-ay.marginwidth);ay.resizable.indexOf("y")!=-1&&ay.ismarginheight&&aw.set(W,av-ay.marginheight)},onResizeStart:function(aw){var av=this;d=true;e=aw.xy;av.outline.setStyle({zIndex:1,width:av.wrap.getWidth()+"px",height:av.wrap.getHeight()+"px"});Ext.getBody().on("mousemove",av.onResizeMove,av).on("mouseup",av.onResizeEnd,av);H="onResizeEnd";ai(aw)},onResizeMove:function(az){var ay=this,av=ay.wrap,aC=av.getXY(),aD=az.xy[0]-e[0],aB=az.xy[1]-e[1],aA=ak(ay.width+aD,ay.getMinWidth()),ax=ak(ay.height+aB,ay.getMinHeight()),aw="";if(az.ctrlKey||az.altKey){aA-=aA%((az.ctrlKey?5:1)*(az.altKey?10:1));ax-=ax%((az.ctrlKey?5:1)*(az.altKey?10:1))}if(ay.resizable.indexOf("x")!=-1){ay.outline.setWidth(aA);aw+="W:"+aA}if(ay.resizable.indexOf("y")!=-1){ay.outline.setHeight(ax);aw+="H:"+ax}ae.log(aw).show(aC[0]+aA/2,aC[1]+ax+ae.height())},onResizeEnd:function(ax){var aw=this,av=aw.outline.dom.style;if(ax!==true){if(aw.resizable.indexOf("x")!=-1){aw.getRecord().set(Q,parseInt(av.width))}if(aw.resizable.indexOf("y")!=-1){aw.getRecord().set(W,parseInt(av.height))}}av.cssText="";d=false;ae.hide();Ext.getBody().un("mousemove",aw.onResizeMove,aw).un("mouseup",aw.onResizeEnd,aw)},onMoveStart:function(ax,av){var aw=I=this;Ext.getBody().on("mouseup",aw.onDropEnd,aw).on("mousemove",aw.onMove,aw);e=ax.xy;ai(ax)},onMove:function(aA,aw){var az=aA.xy,av=az[0],aB=az[1],ay=this,ax=ay.wrap;if((av!=e[0]||aB!=e[1])&&!d){ae.log(ax.is("td")?ax.parent("table"):ax,0.8).show(av+ae.width()/2+20,aB+ae.height()/2+20,false);ay.fireEvent("drag",ay);T.fire();H="cancelDrag";d=true;ay.focus()}},cancelDrag:function(){var aw=this,av=aw.ref;av.owner.add(aw,av.index);r.fire();P.hide();delete aw.ref;aw.focus()},onDropEnd:function(aw){var av=this;Ext.getBody().un("mouseup",av.onDropEnd,av).un("mousemove",av.onMove,av);ae.hide(false);d=false},onFocus:function(ax){var av=this,aw=av.dataset;if(!av.isFocus){av.isFocus=true;av.wrap.addClass("editor-focus").on("mousemove",av.onMouseMove,av);av.getRecord()&&aw.locate(aw.indexOf(av.getRecord())+1,false);ai(ax)}},onBlur:function(){var av=this;if(av.isFocus){av.isFocus=false;av.wrap.removeClass("editor-focus").un("mousemove",av.onMouseMove,av);return true}},onMouseOver:function(av){!d&&this.wrap.addClass("editor-hover");ai(av)},onMouseOut:function(av){!d&&this.wrap.removeClass("editor-hover");ai(av)},onMouseMove:function(av){},onMouseDown:function(ay,av){var ax=this,aw=ax.wrap;if(!ax.isFocus&&!ax.editing){ax.focus();ai(ay)}},onKeyDown:function(aw){var av=this;if(av.isFocus){switch(aw.keyCode){case 18:ai(aw);break;case 27:d?av.cancelAction():av.blur();break;case 46:case 8:av.close(aw)}aw.keyCode==18&&ai(aw)}},onDblClick:function(av){},onClick:function(av){},cancelAction:function(){H&&this[H](true)},onClose:function(){var av=this;av.dataset.remove(av.getRecord())},close:function(ax){var aw=this,aD=ax.xy,av=$A.showConfirm("警告","是否删除当前"+aw.type+"控件？",aw.onClose.createDelegate(aw),function(){aw.focus()}),az=$A.getViewportWidth(),aB=av.wrap.getWidth(),aA=aD[0],ay;if(ax.type=="keydown"){var aC=Ext.fly(ax.target);aD=aC.getXY();aA=aD[0]+aC.getWidth()}aA-=aB/2;ay=aD[1];if(aA+aB>az){aA=az-aB}av.move(aA,ay)},destroy:function(){var av=this;an.prototype.destroy.call(av);av.processListener("un");av.wrap.remove()}})}(),ac=Ext.extend(f,{initComponent:function(ap){var ar=this,aq=ar.wrap=new Ext.Template(ar.wrapTplt).append(D,{width:ar.width,height:ar.height},true);ar.el=aq.child("input")},setHeight:function(ap){if(f.prototype.setHeight.call(this,ap)!=false){this.el.setHeight(ap)}}}),ag=function(){var ap=-1,au=['<th class="layout-th empty-text no-prompt" data-column="{columnindex}">',aa("text-content",{},"Prompt"),aa("box-column-outline"),"</th>"],av=['<td unselectable="on"  class="layout-td-cell {cls}" style="padding:6px">',aa("box-td-content"),aa("box-column-outline"),"</td>"],at='<span class="box-size-panel" unselectable="on"></span>',ar=['<div class="editor-menu-view item-shadow" >','<div class="editor-menu-view-header">',"行列","</div>",'<div class="editor-menu-view-content">','<table width="100%">',"<tr>","<td>行：</td>",'<td><input style="width:40px;" data-size="row_count"></input></td>',"<td>列：</td>",'<td><input style="width:40px;" data-size="column_count"></input></td>',"</tr>","</table>","</div>","</div>"],aq;return Ext.extend(f,{wrapTplt:['<table cellspacing="0" cellpadding="0">','<tr><td tabIndex="0" hideFocus class="layout-table box-editor can-drop editor-wrap empty-box">','<div class="editor-input item-tf item-wrap"><input class="item-textField" style="text-align:left;text-indent:5px" autocomplete="off" type="input" tabIndex="-1"></input></div>','<table cellpadding="0" cellspacing="0" border="0" style="width:{width}px">',"<tbody>","<tr></tr>","</tbody>","</table>","</td></tr>","</table>"],constructor:function(aw){var ax=this;f.prototype.constructor.call(ax,aw);ax.redraw()},initComponent:function(aw){var az=this,ay=az.wrap=new Ext.Template(az.wrapTplt).append(D,{width:az.width},true).child(">tbody>tr>td"),ax=az.editor=ay.child(">.editor-input");ax.el=ax.child("input");az.body=ay.child("table");az.children=[]},initOthers:function(){var aw=this;f.prototype.initOthers.call(aw);aw.sizable&&aw.initSize()},initSize:function(){var aw=this;aw.sizeIcon=new Ext.Template(at).insertFirst(aw.wrap,{},true);if(!aq){aq=new Ext.Template(ar).insertFirst(Ext.getBody(),{},true);aq.rowInput=aq.child("input[data-size=row_count]");aq.columnInput=aq.child("input[data-size=column_count]")}aw.refreshSizePanel()},isEmpty:function(){return !this.children.length},refreshSizePanel:function(){var ax=this,aw=ax.column||-1,ay=ax.row||-1;if(aw==-1){aw=1}if(ay==-1){ay="∞"}ax.sizeIcon.update(ay+"×"+aw)},processListener:function(aw){var ax=this;f.prototype.processListener.call(ax,aw);T[aw](ax.onDrag,ax);ax.sizable&&ax.sizeIcon[aw]("click",ax.showSizePanel,ax)},showSizePanel:function(aB,aI){aI=Ext.fly(aI);aq.setStyle({display:"block"}).appendTo(this.wrap);var aA=this,aJ=aI.getXY(),aw=aI.getWidth(),aF=aJ[0],aC=aJ[1],aE=o,ay=i,aD=aj.getScroll(),ax=aD.left,aH=aD.top,aG=aq.getWidth(),az=aq.getHeight();if(aF+aw+aG>aE+ax){aF-=aG}else{aF+=aw}if(aC+az>ay+aH){aC=ay-az}aA.bindSizePanel();aq.moveTo(aF,aC);Ext.getBody().on("mousedown",aA.triggerSizePanel,aA);aA.wrap.addClass("editor-focus")},bindSizePanel:function(){var aw=this;aq.rowInput.on("change",aw.onSizeChange,aw).dom.value=aw.row||0;aq.columnInput.on("change",aw.onSizeChange,aw).dom.value=aw.column||1},unBindSizePanel:function(){var aw=this;aq.rowInput.un("change",aw.onSizeChange,aw);aq.columnInput.un("change",aw.onSizeChange,aw)},triggerSizePanel:function(ax,aw){aw=t(aw);if(this.sizeIcon!=aw&&!aq.contains(aw)){this.hideSizePanel()}},hideSizePanel:function(){var aw=this;aw.unBindSizePanel();aq.setStyle({display:""});Ext.getBody().un("mousedown",aw.triggerSizePanel,aw);!aw.isFocus&&aw.wrap.removeClass("editor-focus")},refreshSize:function(ay,aw){var ax=this;ax.row=Number(ay);ax.column=Number(aw);ax.refreshSizePanel();ax.redraw()},onSizeChange:function(ay,aw){var ax=this;ax.getRecord().set(t(aw).getAttributeNS("","data-size"),aw.value)},showEditor:function(aA,ay,aw,ax){var az=this;az.editing=true;az.bindEditor(aA,ay,aw,ax);az.editor.el.on("blur",az.hideEditor,az).focus();!az.isFocus&&az.wrap.addClass("editor-focus")},bindEditor:function(aB,az,aw,ay){var aA=this,ax=aA.editor;ax.binder={el:az,attr:aw,emptytext:ay};ax.el.dom.value=az[aw]||"";(ax.setXY(aB.getXY()).setHeight(aB.getHeight()).setWidth(aB.getWidth())).target=aB},hideEditor:function(){var ax=this,aw=ax.editor,ay=aw.target;ax.editing=false;ax.updatePrompt(ay);aw.setXY([-1000,-1000]);aw.el.un("blur",ax.hideEditor,ax).blur();!ax.isFocus&&ax.wrap.removeClass("editor-focus")},updatePrompt:function(aB){var aA=this,az=aA.editor,ay=az.binder,aw=ay.attr,aC=ay.el[aw]=az.el.dom.value,ax;aB[Ext.isEmpty(aC)?"addClass":"removeClass"]("empty-text").child(".text-content").update((aC||ay.emptytext)+(aw=="prompt"?":":""));if(false&&aw=="prompt"&&!Ext.isEmpty(aC)&&(ax=aA.getLabelMinWidth())>aA.getLabelWidth()){aA.setLabelWidth(ax)}},onClick:function(aA,ax){var ay=this,az=ax=t(ax);if(az.is(".layout-th")||(az=ax.parent(".layout-th"))){var aw=az.getAttributeNS("","data-childindex"),aB=ay.children[aw];aB&&ay.showEditor(az,aB,"prompt","Prompt")}},onDrag:function(){var aw=this;aw.wrap.on("mousemove",aw.onDragOver,aw).on("mouseleave",aw.onDragLeave,aw).on("mouseup",aw.onDrop,aw)},onDragOver:function(az,ax){var ay=this,aw=az.xy[0],aA=az.xy[1];ae.isShow()&&ae.show(aw+ae.width()/2+20,aA+ae.height()/2+20,false);N.start(function(){ax=t(ax);ax=ax.is(".box-editor")?ax:ax.parent(".box-editor");if(ax){var aG=ay.wrap,aE=ay.children,aH=aG.getXY(),aD=aw-aH[0],aC=aA-aH[1],aB=0,aF=0;ap=-1;ay.body.select(">tbody>tr").each(function(aJ,aI,aK){aF+=aJ.getHeight();if(aC<aF){aJ.select(">.layout-td-cell").each(function(aO,aN,aM){var aL=(aO.getWidth()+aO.prev().getWidth())/2;aB+=aL;if(aD<aB){ap=Number(aO.getAttributeNS("","data-childindex")||-1);return true}aB+=aL});return true}});if(ap==-1){ap=aE.length}if(ay.dropIndex!=ap){if(P.isShow()){P.hide()}ay.dropIndex=ap;ay.redraw(true)}}},50);ai(az)},onDragLeave:function(ax,aw){N.end();P.hide()},onDrop:function(aB,ay){var aA=this;N.end();if(P.isShow()){if(Ext.isString(I)){aA.dataset.create(z(I,ap,aA.id),ap)}else{var az=I.getRecord(),ax=az.get(B),aw=az.get(Z);if(ax==aA.id&&aw==ap){I.cancelDrag();ai(aB);return}az.set(B,aA.id);az.set(Z,ap)}}r.fire();ai(aB)},onDropEnd:function(){var aw=this;f.prototype.onDropEnd.call(aw);aw.wrap.un("mousemove",aw.onDragOver,aw).un("mouseleave",aw.onDragLeave,aw).un("mouseup",aw.onDrop,aw);delete aw.dropIndex},add:function(az,aw){var ay=this,ax=ay.children.indexOf(az);if(ax==aw){return}else{if(ax!=-1){ay.onChildRemove(az)}}ay.pushChild(az,aw);az.on("resize",ay.onChildResize,ay);az.on("destroy",ay.onChildRemove,ay);az.on("drag",ay.onChildRemove,ay);az.fireEvent("resize",az);ay.redraw();az.focus();P.un("hide",ay.onProxyHide,ay);P.hide()},create:function(aw,ax){var aA=this,az=G.get(aw.get(g));if(!az){return}var ay=new ad[az](U({},p(aw),x.get(az)));aA.add(ay,ax);return ay},onChildRemove:function(aB){var ax=this,aA=aB.previousSibling,ay=aB.nextSibling,az=ax.children,aw=az.indexOf(aB);az.splice(aw,1);if(aA){aA.nextSibling=ay}if(ay){ay.previousSibling=aA}delete aB.previousSibling;delete aB.nextSibling;aB.un("destroy",ax.onChildRemove,ax);aB.un("resize",ax.onChildResize,ax);aB.un("drag",ax.onChildRemove,ax);aB.ref={array:az,index:aw,owner:ax};ax.redraw()},pushChild:function(ay,aD){var aC=this,az=aC.children,aG=az[aD-1],ax=az[aD],aF;az.splice(aD,0,ay);if(aG){ay.previousSibling=aG;aG.nextSibling=ay}if(ax){ax.previousSibling=ay;ay.nextSibling=ax}aF=ay.getRecord();while(ax){var aH=ax.getRecord(),aE=aH.get(Z),aB=aF.get(Z);if(aB<aE){ax=null}else{aH.set(Z,aB- -1);aF=ax.getRecord();ax=ax.nextSibling}}aF=ay.getRecord();while(aG){var aw=aG.getRecord(),aA=aw.get(Z),aB=aF.get(Z);if(aB>aA){aG=null}else{aw.set(Z,aB-1);aF=aG.getRecord();aG=aG.previousSibling}}},onChildResize:function(ay){var aw=this,ax=ay.wrap.parent("td");ax&&ax.parent("tr").select(">th>.box-column-outline").setHeight(ax.getHeight());aw.fireEvent("resize",aw)},redraw:function(aF){var aS=this,ay=aS.column||-1,aI=aS.row||-1,aK=aS.body,aM=aK.child("tbody"),aL=S.createElement("tbody"),aw=aS.children,aD=0,aR=0,aP,ax,aJ=aS.columns=[];aK.dom.appendChild(aL);if(aF){aP=J(I);aw.splice(ap,0,Ext.apply(aP,{type:Ext.isString(I)?I:I.type}))}var aG=aw.length;if(aG){if(ay==-1){if(aI==-1){ay=1;aI=aG}else{ay=Math.ceil(aG/aI)}}else{if(aI==-1){aI=Math.ceil(aG/ay)}}for(var aQ=0;aQ<aI;aQ++){ax=t(aL.insertRow(-1));var az=false;for(var aO=0;aO<ay;aO++){var aC=aQ*ay+aO,aB=aw[aC];if(aB){var aA=aS.createEmptyTh(ax,aO,true),aE=aS.createEmptyTd(ax,aO==ay-1,true),aN=aE.child(".box-td-content");if(aQ==0){aJ.push({wrap:aE,labelwrap:aA.child(".text-content").setWidth(0),noPrompt:true})}else{if(!aJ[aO].noPrompt){aA.removeClass("no-prompt")}}if(aB.prompt||aB.type=="TextField"){aJ[aO].labelwrap.setWidth(aS.labelwidth);aJ[aO].noPrompt=false;Ext.fly(aL).select("th[data-column="+aO+"]").removeClass("no-prompt")}if(aB===aP){aS.showProxy(aN,aP)}else{var aH=aB.wrap;if(aH.is("td")){aH=aH.parent("table")}aH.appendTo(aN);aA.set({"data-childindex":aC}).child(".text-content").update(aB.prompt||"Prompt");aE.set({"data-childindex":aC});!Ext.isEmpty(aB.prompt)&&aA.removeClass("empty-text")}aA.parent("tr").select(">th>.box-column-outline").setHeight(aA.getHeight())}else{az=true;break}}if(az){break}}}else{var ax=t(aL.insertRow(-1)),aA=aS.createEmptyTh(ax,0,true),aE=aS.createEmptyTd(ax,true,true),aN=aE.child(".box-td-content");aJ.push({wrap:aE,labelwrap:aA.child(".text-content").setWidth(0),noPrompt:true})}if(aS.isEmpty()){aS.wrap.addClass("empty-box");aS.body.setWidth(x.get(aS.type).width)}else{aS.wrap.removeClass("empty-box");aS.body.setStyle({width:""})}aF&&aw.remove(aP);aM.remove()},createEmptyTh:function(ax,ay,aw){return new Ext.Template(au).append(ax,{columnindex:ay},aw)},createEmptyTd:function(ay,ax,aw){return new Ext.Template(av).append(ay,{cls:ax?"box-last-cell":""},aw)},showProxy:function(ay,ax){var aA=this,aw=ax.width,az=ax.height;P.height(az).width(aw).show(ay).on("hide",aA.onProxyHide,aA)},onProxyHide:function(){var aw=this;delete aw.dropIndex;aw.redraw();P.un("hide",aw.onProxyHide,aw)},setWidth:function(aw){var ax=this;if(aw==ax.width){return}ax.body.setWidth(aw);ax.width=ax.body.getWidth();ax.fireEvent("resize",ax)}})}(),ad={TextField:Ext.extend(ac,{type:"TextField",wrapTplt:['<DIV tabindex="0" class="item-tf item-wrap editor-wrap" style="width:{width}px;height:{height}px;" >','<DIV class="item-input-wrap">','<INPUT  style="height:{height}px;text-indent:2px;" disabled class="item-textField" />',"</DIV>","</DIV>"]}),VBox:Ext.extend(ag,{type:"VBox"}),HBox:Ext.extend(ag,{type:"HBox"}),Form:Ext.extend(ag,{type:"Form",wrapTplt:['<table cellspacing="0" cellpadding="0">','<tr><td tabIndex="0" hideFocus class="layout-table box-editor form-editor can-drop editor-wrap empty-box">','<div class="editor-input item-tf item-wrap"><input class="item-textField" style="text-align:left;text-indent:5px" autocomplete="off" type="input" tabIndex="-1"></input></div>','<table cellpadding="0" cellspacing="0" border="0" style="width:{width}px" class="layout-table layout-form layout-title">',"<thead>","<tr>",'<th class="form_head empty-text">','<div class="text-content">Title</div>','<div unselectable="on" class="box-row-outline"></div>',"</th>","</tr>","</thead>","<tbody>","<tr></tr>","</tbody>","</table>","</td></tr>","</table>"],initComponent:function(ap){var aq=this;ag.prototype.initComponent.call(aq,ap);aq.headTitle=aq.wrap.child(".form_head")},redraw:function(ap){ag.prototype.redraw.call(this,ap);this.refreshHead()},refreshHead:function(){this.headTitle.dom.colSpan=this.columns.length*2}}),FieldBox:function(){var az,aB,ap=-1,aA=-1,au=-1,at=false,aq=false,ay,ax=['<table cellpadding="0" cellspacing="0">','<tr><td tabIndex="0" hideFocus class="layout-table box-editor can-drop editor-wrap empty-box">','<div class="screen-editor-spliter" hideFocus="true"></div>','<div class="editor-input item-tf item-wrap"><input class="item-textField" style="text-align:left;text-indent:5px" autocomplete="off" type="input" tabIndex="-1"></input></div>','<table cellpadding="0" cellspacing="0">',"<thead>","<tr>",'<th class="fieldbox_head empty-text">','<div class="text-content">Title</div>','<div unselectable="on" class="box-row-outline"></div>',"</th>","</tr>","</thead>","<tbody>","<tr></tr>","</tbody>","</table>","</td></tr>","</table>"],av=['<th class="layout-th empty-text" data-column="{columnindex}">','<div class="text-content" unselectable="on">Prompt</div>','<div unselectable="on" class="box-column-outline"></div>',"</th>"],aw=['<td unselectable="on"  class="layout-td-cell {cls}" style="padding:6px">','<div class="box-td-content" unselectable="on"></div>','<div unselectable="on" class="box-column-outline"></div>',"</td>"],ar=Ext.extend(an,{type:"FieldBoxColumn",initComponent:function(aC){this.children=[]},initEvents:function(){var aC=this;an.prototype.initEvents.call(aC);aC.addEvents("childremove")},refreshBox:function(){var aE=this,aC=aE.wrap,aD=aC.parent("table");aE.totalMarginWidth=aC.getPadding("lr")+aC.getBorderWidth("lr")+aD.getBorderWidth("lr"),aE.totalMarginHeight=aC.getPadding("tb")+aD.getBorderWidth("tb")},onChildRemove:function(aH){var aD=this,aG=aH.previousSibling,aE=aH.nextSibling,aF=aD.children,aC=aF.indexOf(aH);aF.splice(aC,1);if(aG){aG.nextSibling=aE}if(aE){aE.previousSibling=aG}delete aH.previousSibling;delete aH.nextSibling;aH.ref={array:aF,index:aC,owner:aD};aH.un("resize",aD.onChildResize,aD);aH.un("destroy",aD.onChildRemove,aD);aH.un("drag",aD.onChildRemove,aD);aD.redraw()},redraw:function(aC){this.fireEvent("redraw",this)},add:function(aF,aC){var aE=this,aD=aE.children.indexOf(aF);if(aD==aC){return}else{if(aD!=-1){aE.onChildRemove(aF)}}aE.pushChild(aF,aC);aF.on("resize",aE.onChildResize,aE);aF.on("destroy",aE.onChildRemove,aE);aF.on("drag",aE.onChildRemove,aE);aF.fireEvent("resize",aF);aE.redraw();aF.focus()},create:function(aC,aD){var aG=this,aF=G.get(aC.get(g));if(!aF){return}var aE=new ad[aF](U({},p(aC),x.get(aF)));aG.add(aE,aD);return aE},pushChild:function(aE,aJ){var aI=this,aF=aI.children,aM=aF[aJ-1],aD=aF[aJ],aL;aF.splice(aJ,0,aE);if(aM){aE.previousSibling=aM;aM.nextSibling=aE}if(aD){aD.previousSibling=aE;aE.nextSibling=aD}aL=aE.getRecord();while(aD){var aN=aD.getRecord(),aK=aN.get(Z),aH=aL.get(Z);if(aH<aK){aD=null}else{aN.set(Z,aH- -1);aL=aD.getRecord();aD=aD.nextSibling}}aL=aE.getRecord();while(aM){var aC=aM.getRecord(),aG=aC.get(Z),aH=aL.get(Z);if(aH>aG){aM=null}else{aC.set(Z,aH-1);aL=aM.getRecord();aM=aM.previousSibling}}},onChildResize:function(aF){var aD=this,aC=aF.getWidth()-aD.getFieldWidth(true),aE=aF.wrap.parent("td");aC>0&&aD.getRecord().set(a,aD.getFieldWidth()+aC);aE&&aE.parent("tr").select(">th>.box-column-outline").setHeight(aE.getHeight())},getWidth:function(){return this.labelwidth+this.fieldwidth},setWidth:function(aC){this.setFieldWidth(aC-this.getLabelWidth())},getFieldMinWidth:function(){var aD=this,aC=aD.minwidth;k(aD.children,function(aE){aC=ak(aE.getWidth(),aC)});return aC+aD.totalMarginWidth},getMinWidth:function(){return this.getLabelWidth()+this.getFieldMinWidth()},getLabelMinWidth:function(){var aD=this,aC=aD.labelminwidth;if(aD.children.length){k(aD.children,function(aE){aC=ak(aC,L.update(aE.prompt||"prompt").getWidth())})}else{aC=ak(aC,L.update("prompt").getWidth())}return aC},getLabelWidth:function(){return this.labelwidth},setLabelWidth:function(aC){var aD=this;if(aD.labelwidth==aC){return}aD.labelwidth=aC;aD.labelwrap.child(".text-content").setWidth(aC);aD.fireEvent("resize")},getFieldWidth:function(aD){var aC=this;return aC.fieldwidth-(aD?aC.totalMarginWidth:0)},setFieldWidth:function(aC){var aD=this;if(aD.fieldwidth==aC){return}aD.fieldwidth=aC=Math.max(aC,aD.getFieldMinWidth());aD.wrap.child(".box-td-content").setWidth(aC-aD.totalMarginWidth);aD.fireEvent("resize")}});return Ext.extend(f,{type:"FieldBox",constructor:function(aC){var aD=this;f.prototype.constructor.call(aD,aC);aD.createColumn(aD.width)},initComponent:function(aC){var aF=this,aE=aF.wrap=new Ext.Template(ax).append(D,{},true).child(">tbody>tr>td"),aD=aF.editor=aE.child(">.editor-input");aD.el=aD.child("input");aF.body=aE.child("table");aF.headTitle=aE.child(".fieldbox_head");aF.spliter=aE.child(".screen-editor-spliter");aF.children=[]},processListener:function(aC){var aD=this;f.prototype.processListener.call(aD,aC);T[aC](aD.onDrag,aD)},isEmpty:function(){var aC=true;k(this.children,function(aD){if(aD.children.length){return aC=false}});return aC},showEditor:function(aH,aF,aC,aE,aD){var aG=this;aG.editing=true;aG.bindEditor(aH,aF,aC,aE,aD);aG.editor.el.on("blur",aG.hideEditor,aG).focus();aG.wrap.addClass("editor-focus")},bindEditor:function(aI,aG,aC,aF,aE){var aH=this,aD=aH.editor;aD.binder={el:aG,attr:aC,emptytext:aF,col:aE};aD.el.dom.value=aG[aC]||"";(aD.setXY(aI.getXY()).setHeight(aI.getHeight()).setWidth(aI.getWidth())).target=aI},hideEditor:function(){var aD=this,aC=aD.editor,aE=aC.target;aD.editing=false;aD.updatePrompt(aE);aC.setXY([-1000,-1000]);aC.el.un("blur",aD.hideEditor,aD).blur();!aD.isFocus&&aD.wrap.removeClass("editor-focus")},updatePrompt:function(aI){var aH=this,aF=aH.editor,aE=aF.binder,aC=aE.attr,aG=aE.col,aJ=aE.el[aC]=aF.el.dom.value,aD;aI[Ext.isEmpty(aJ)?"addClass":"removeClass"]("empty-text").child(".text-content").update((aJ||aE.emptytext)+(aC=="prompt"?":":""));if(aC=="prompt"&&!Ext.isEmpty(aJ)&&(aD=aG.getLabelMinWidth())>aG.getLabelWidth()){aG.setLabelWidth(aD)}},onClick:function(aH,aE){var aF=this,aG=aE=t(aE);if(aE==aF.headTitle||(aG=aE.parent(".fieldbox_head"))){aF.showEditor(aG,aF,"title","Title")}else{if((aG=aE).is(".layout-th")||(aG=aE.parent(".layout-th"))){var aJ=aG.getAttributeNS("","data-column"),aD=aG.getAttributeNS("","data-childindex"),aC=aF.children[aJ],aI=aC.children[aD];aI&&aF.showEditor(aG,aI,"prompt","Prompt",aC)}}},onDrag:function(){var aC=this;aC.wrap.on("mousemove",aC.onDragOver,aC).on("mouseleave",aC.onDragLeave,aC).on("mouseup",aC.onDrop,aC)},onDragOver:function(aF,aD){var aE=this,aC=aF.xy[0],aG=aF.xy[1];ae.isShow()&&ae.show(aC+ae.width()/2+20,aG+ae.height()/2+20,false);N.start(function(){aD=t(aD);aD=aD.is(".layout-td-cell")?aD:aD.parent(".layout-td-cell");if(aD){au=aD.parent().select(">.layout-td-cell").indexOf(aD);var aI=aE.children[au],aL=aE.wrap,aJ=aI.children,aH=aG-aL.getXY()[1],aK=0;aA=-1;k(aJ,function(aO,aN){var aM=aO.getHeight()/2;aK+=aM;if(aH<aK){aA=aN;return false}else{aK+=aM}});if(aA==-1){aA=aJ.length}if(aI.dropIndex!=aA){if(P.isShow()){P.hide()}aI.dropIndex=aA;aE.redraw(true)}}},50);ai(aF)},onDragLeave:function(aD,aC){N.end();P.hide()},onDrop:function(aI,aF){var aH=this,aE=aH.children[au];N.end();if(P.isShow()){if(Ext.isString(I)){aH.dataset.create(z(I,aA,aE.id),aA)}else{var aG=I.getRecord(),aD=aG.get(B),aC=aG.get(Z);if(aD==aE.id&&aC==aA){I.cancelDrag();ai(aI);return}aG.set(B,aE.id);aG.set(Z,aA)}P.un("hide",aH.onProxyHide,aH);P.hide()}r.fire();ai(aI)},onDropEnd:function(){var aC=this;f.prototype.onDropEnd.call(aC);aC.wrap.un("mousemove",aC.onDragOver,aC).un("mouseleave",aC.onDragLeave,aC).un("mouseup",aC.onDrop,aC);if(au!=-1){delete aC.children[au].dropIndex}},redraw:function(aC){var aI=this,aE=aI.children,aF=0,aH=aI.body,aD=aH.child("tbody"),aO=S.createElement("tbody"),aM=aE.length,aL,aN=0,aJ,aK;k(aE,function(aP){aF=ak(aP.children.length,aF)});aH.dom.appendChild(aO);if(aC===true){aJ=J(I);var aG=aE[au];aL=aG.children;aL.splice(aA,0,aJ);aF=ak(aL.length,aF)}do{k(aE,function(aT,aV){if(aV==0){aK=t(aO.insertRow(-1))}var aS=aT.children,aR=aS[aN],aQ=aI.createEmptyTh(aK,aV,true),aU=aI.createEmptyTd(aK,aV==aM-1,true),aW=aU.child(".box-td-content"),aX=aT.getFieldWidth();if(aN==0){aT.wrap=aU;aT.labelwrap=aQ;aT.refreshBox();aW.setWidth(aS.indexOf(aJ)!=-1?Math.max(aJ.width,aX):aX-aT.totalMarginWidth);aQ.child(".text-content").setWidth(aT.getLabelWidth())}if(aR){if(aR===aJ){aI.showProxy(aW,aJ)}else{var aP=aR.wrap;if(aP.is("td")){aP=aP.parent("table")}aP.appendTo(aW);aQ.set({"data-childindex":aN}).child(".text-content").update((aR.prompt||"Prompt")+":");!Ext.isEmpty(aR.prompt)&&aQ.removeClass("empty-text")}aQ.parent("tr").select(">th>.box-column-outline").setHeight(aQ.getHeight())}if(aV==aM-1){aN++}})}while(aN<aF);if(aI.isEmpty()){aI.wrap.addClass("empty-box")}else{aI.wrap.removeClass("empty-box")}aC===true&&aL.remove(aJ);aD.remove()},showProxy:function(aE,aD){var aG=this,aC=aD.width,aF=aD.height;P.height(aF).width(aC).show(aE).on("hide",aG.onProxyHide,aG)},onProxyHide:function(){var aC=this;delete aC.children[au].dropIndex;aC.redraw();P.un("hide",aC.onProxyHide,aC)},createEmptyTh:function(aD,aE,aC){return new Ext.Template(av).append(aD,{columnindex:aE},aC)},createEmptyTd:function(aE,aD,aC){return new Ext.Template(aw).append(aE,{cls:aD?"box-last-cell":""},aC)},create:function(aC,aD){var aF=this,aE=new ar(U({},p(aC),x.get("FieldBoxColumn")));aF.add(aE,aD);return aE},add:function(aF,aC){var aE=this,aD=aE.children.indexOf(aF);if(aD==aC){return}else{if(aD!=-1){aE.onChildRemove(aF)}}aE.pushChild(aF,aC);aF.on("redraw",aE.redraw,aE);aF.on("resize",aE.onChildResize,aE);aF.on("destroy",aE.onChildRemove,aE);aE.refreshHead();aE.redraw()},pushChild:function(aE,aJ){var aI=this,aF=aI.children,aM=aF[aJ-1],aD=aF[aJ],aL;aF.splice(aJ,0,aE);if(aM){aE.previousSibling=aM;aM.nextSibling=aE}if(aD){aD.previousSibling=aE;aE.nextSibling=aD}aL=aE.getRecord();while(aD){var aN=aD.getRecord(),aK=aN.get(Z),aH=aL.get(Z);if(aH<aK){aD=null}else{aN.set(Z,aH- -1);aL=aD.getRecord();aD=aD.nextSibling}}aL=aE.getRecord();while(aM){var aC=aM.getRecord(),aG=aC.get(Z),aH=aL.get(Z);if(aH>aG){aM=null}else{aC.set(Z,aH-1);aL=aM.getRecord();aM=aM.previousSibling}}},createColumn:function(aD,aC){var aE=this,aF={label_width:aE.labelwidth,field_width:aD-aE.labelwidth};aF[l]="editor-"+(++al);aF[g]=G.find("FieldBoxColumn");aF[Z]=aC||0;aF[B]=aE.id;aE.dataset.create(aF)},onChildRemove:function(aH){var aD=this,aG=aH.previousSibling,aE=aH.nextSibling,aF=aD.children,aC=aF.indexOf(aH);aF.splice(aC,1);if(aG){aG.nextSibling=aE}if(aE){aE.previousSibling=aG}delete aH.previousSibling;delete aH.nextSibling;aH.un("redraw",aD.redraw,aD);aH.un("resize",aD.onChildResize,aD);aH.un("destroy",aD.onChildRemove,aD);aD.redraw()},resizeColumn:function(aE,aD){var aC=this.children[aD];aC.getRecord().set(at?Y:a,at?aE:aE-aC.getLabelWidth())},refreshHead:function(){this.headTitle.dom.colSpan=this.children.length*2},onChildResize:function(){var aD=this,aC=aD.wrap;aD.width=aC.getWidth()},getMinWidth:function(){var aC=this,aD=0;k(aC.children,function(aE){aD+=aE.getMinWidth()});return aD},setWidth:function(aC,aG){var aF=this,aE=aF.width-aC;if(aE==0){return}var aD=aF.children[aF.children.length-1];if(!aG){aD.setWidth(aD.getWidth()-aE)}f.prototype.setWidth.call(aF,aC)},getHeight:function(){return this.wrap.getHeight()},onBlur:function(){var aC=this;f.prototype.onBlur.call(aC)&&aC.wrap.removeClass(["can-split","can-col-resize"])},onDblClick:function(aE){var aD=this;if(aD.wrap.hasClass("can-col-resize")){var aC=aD.children[ap+1];!at&&aC&&$A.showConfirm("警告","是否删除右侧列？",function(){aD.dataset.remove(aC.getRecord())})}},onMouseDown:function(aE){var aD=this,aC=aD.wrap;if(aD.isFocus){ai(aE);if(aC.hasClass("can-split")){aD.onSplitStart(aE)}else{if(aC.hasClass("can-col-resize")){aD.onColumnResizeStart(aE)}}}f.prototype.onMouseDown.call(aD,aE)},onMouseMove:function(aD){var aC=this;!d&&aC.wrap[aC.canSplit(aD)?"addClass":"removeClass"]("can-split")[aC.canColumnResize(aD)?"addClass":"removeClass"]("can-col-resize")},onColumnResizeStart:function(aH){if(ap==-1){return}var aF=this,aE=aF.wrap,aC=aH.xy[0],aG=aE.getXY(),aD=aE.getHeight(),aI=aG[1];ay=0;k(aF.children,function(aK,aJ){if(aJ==ap){return false}else{ay+=aK.getWidth()}});aB=az=aC-aG[0]+1;aF.spliter.setXY([aC,aI]).setHeight(aD);Ext.getBody().on("mousemove",aF.onColumnResizeMove,aF).on("mouseup",aF.onColumnResizeEnd,aF);d=true;H="onColumnResizeEnd"},onColumnResizeMove:function(aI){var aG=this,aH=aG.wrap.getXY(),aD=aH[0],aC=aG.children[ap],aF=aG.children[ap+1],aE=at?aC.getLabelMinWidth():aC.getMinWidth();aB=aI.xy[0]-aD+1;if(aI.ctrlKey||aI.altKey){aB-=aB%((aI.ctrlKey?5:1)*(aI.altKey?10:1))}if(aB<ay+aE){aB=ay+aE}aG.spliter.setX(aB+aD-1);ae.log("X:"+aB).show(aH[0]+aB,aH[1]+aG.wrap.getHeight()/2)},onColumnResizeEnd:function(aD){var aC=this;if(aB!=az&&aD!==true){aC.resize(aB)}aC.spliter.setXY([-10000,-10000]);Ext.getBody().un("mousemove",aC.onColumnResizeMove,aC).un("mouseup",aC.onColumnResizeEnd,aC);d=false;ae.hide()},onSplitStart:function(aH){var aF=this,aE=aF.wrap,aD=aH.xy[0],aG=aE.getXY(),aI=aG[1],aC=aH.xy[1]-aI;az=aD-aG[0]+1;aF.spliter.setXY([aD,aI]).setHeight(aC);Ext.getBody().on("mousemove",aF.onSplitMove,aF).on("mouseup",aF.onSplitEnd,aF);d=true;H="onSplitEnd"},onSplitMove:function(aF){var aE=this.wrap,aC=aF.xy[1]-aE.getXY()[1],aD=aE.getHeight();if(aq=aC>=aD){aC=aD}this.spliter.setHeight(aC)},onSplitEnd:function(aD){var aC=this;Ext.getBody().un("mousemove",aC.onSplitMove,aC).un("mouseup",aC.onSplitEnd,aC);if(aq&&aD!==true){aC.split(az)}aC.spliter.setXY([-10000,-10000]);d=false;aq=false},resize:function(aC){var aD=this;k(aD.children,function(aF,aE){if(aE==ap){aD.resizeColumn(aC,aE);return false}else{aC-=aF.getWidth()}})},split:function(aC){var aD=this;k(aD.children,function(aG,aF){var aE=aG.getWidth();if(aE>aC){aG.getRecord().set(a,aC-aG.getLabelWidth());aD.createColumn(aE-aC,aF+1);return false}else{aC-=aE}})},canSplit:function(aG){var aF=this,aD=aF.children,aC=aF.wrap,aJ=aC.getWidth(),aK=aC.getXY(),aI=aG.xy[0]-aK[0],aH=false,aE=aD[0];if(aI>aE.getMinWidth()){aJ=0;k(aD,function(aM,aL){aJ+=aM.getWidth();var aN=aD[aL+1];if(aI<aJ-aM.getMinWidth()-aM.totalMarginWidth){aH=true;return false}else{if(aN&&aI>aJ+aN.getMinWidth()){aH=true}else{return aH=false}}})}return aH},canColumnResize:function(aH){var aF=this,aD=0,aG=aF.wrap.getXY(),aC=aH.xy[0]-aG[0],aE=false;ap=-1;k(aF.children,function(aJ,aI){aD+=aJ.getLabelWidth();if(aC<aD+5&&aC>aD-5){aE=true;at=true;ap=aI;return false}aD+=aJ.getFieldWidth();if(aC<aD+5&&aC>aD-5){aE=true;at=false;ap=aI;return false}});return aE}})}(),Grid:function(){var au,aw=26,aq=false,ap=-1,az=-1,at=false,aA,ax,av=['<div tabIndex="0" hideFocus class="grid-editor editor-wrap can-not-drop" style="width:{width}px">','<div class="screen-editor-spliter" hideFocus="true"></div>','<div class="editor-input item-tf item-wrap"><input class="item-textField" style="text-align:center" autocomplete="off" type="input" tabIndex="-1"></input></div>','<table class="item-grid-wrap" cellpadding="0" cellspacing="0" border="0">',"{toolbar}","<tr>",'<td class="layout-td-cell">','<div class="item-grid" style="height:{height}px">','<DIV class="grid-la" unselectable="on" style="width:0;display:none">','<DIV class="grid-lh" unselectable="on" onselectstart="return false;" style="-moz-user-select:none;text-align:left;height:25px;">','<table cellspacing="0" atype="grid.lht" cellpadding="0" border="0">','<tr class="grid-hl">',"</tr>",'<tr height="25">',"</tr>","</table>","</DIV>","</DIV>",'<DIV class="grid-ua" unselectable="on" style="width:{unlockwidth}px;">','<DIV class="grid-uh" unselectable="on" onselectstart="return false;" style="-moz-user-select:none;text-align:left;height:25px;">','<table cellspacing="0" atype="grid.uht" cellpadding="0" border="0">','<tr class="grid-hl">','<th atype="fixed-cell" width="34"> </th>',"</tr>",'<tr height="25">',"</tr>","</table>","</DIV>","</DIV>",'<DIV style="clear:both;"></DIV>',"</div>","</td>","</tr>","<tr>","<td>",'<div class="item-toolbar grid-navbar">','<div class="navbar-{theme}" unselectable="on"></div>',"</div>","</td>","</tr>","</table>","</div>"],ay='<th style="width:{width}px"></th>',ar='<td unselectable="on" class="grid-hc" atype="grid.head"><div unselectable="on">&#160;</div></td>';return Ext.extend(f,{type:"Grid",initComponent:function(aB){var aE=this,aD=aE.wrap=new Ext.Template(av).append(D,{width:aE.width,height:aE.height-2-aw,unlockwidth:aE.width-2,theme:X},true),aF=aE.wb=aD.child(".item-grid"),aC=aE.editor=aD.child(">.editor-input");aE.ua=aF.child(".grid-ua");aE.uh=aF.child(".grid-uh");aE.la=aF.child(".grid-la");aE.lh=aF.child(".grid-lh");aE.spliter=aD.child(".screen-editor-spliter");aC.el=aC.child("input");aE.lockcolumns=[];aE.unlockcolumns=[];aE.lockwidth=aE.unlockwidth=0},createColumn:function(aD){var aE=this,aC=aE.uh.child(".grid-hl"),aB;aE.unlockcolumns.push(aB={width:aD,hl:new Ext.Template(ay).append(aC,{width:aD},true),promptEl:new Ext.Template(ar).append(aC.next(),{},true),prompt:"",lock:false});aC.child("[atype=fixed-cell]").appendTo(aC);aE.syncColumnSize();aE.showEditor(aB)},removeColumn:function(aD,aB){var aG=this,aF=aD.lock,aE=aF?aG.lockcolumns:aG.unlockcolumns,aC=aE.indexOf(aD);aC!=-1&&aE.splice(aC,1);if(aB){aD.promptEl.remove();aD.hl.remove()}else{aD.promptEl.appendTo(D);aD.hl.appendTo(D)}aG.syncColumnSize(aF);return aC},addColumn:function(aD,aH){var aG=this,aJ=aD.lock,aE=aJ?aG.lockcolumns:aG.unlockcolumns,aB=aG[aJ?"lh":"uh"].child(".grid-hl"),aI=aB.next(),aC=aB.query(">[atype!=fixed-cell]").length;aE.splice(aH,0,aD);aG.syncColumnSize(aJ);if(aH==aC||aH==-1||Ext.isEmpty(aH)){aD.hl.appendTo(aB);aD.promptEl.appendTo(aI);if(!aJ){var aF=aG.uh.child(".grid-hl");aF.child("[atype=fixed-cell]").appendTo(aF)}}else{aD.hl.insertBefore(aB.select(">*").item(aH));aD.promptEl.insertBefore(aI.select(">*").item(aH))}},syncColumnSize:function(aD){var aC=this,aB=0;if(aD){k(aC.lockcolumns,function(aE){aB+=aE.width});if(aB==0){aC.la.setWidth(0).setStyle({display:"none"})}else{aC.la.setWidth(++aB)}aC.lockwidth=aB;aC.ua.setWidth(aC.width-aB-2)}else{k(aC.unlockcolumns,function(aE){aB+=aE.width});aC.unlockwidth=aB}aC.uh.setWidth(ak(aC.width-aC.lockwidth-2,aC.unlockwidth)).child("[atype=grid.uht]").setWidth(aC.unlockwidth+34)},getColumns:function(){return this.lockcolumns.concat(this.unlockcolumns)},showEditor:function(aB){var aC=this;aC.bindEditor(aB);aC.editing=true;aC.editor.el.on("keydown",aC.onEditorKeyDown,aC).on("blur",aC.hideEditor,aC).focus();aC.wrap.addClass("editor-focus")},showEditorBy:function(aC){var aE=this,aD=aE.getColumns(),aB=aE.editor.column;aE.updatePrompt(aB);(aB=aD[aD.indexOf(aB)+(aC?-1:1)])?aE.bindEditor(aB):aE.hideEditor()},bindEditor:function(aC){if(!aC){return}var aE=this,aD=aC.promptEl,aB=aE.editor;aE.editing=false;aE.focusColumn(aC);aB.el.dom.value=aC.prompt;(aB.setXY(aD.getXY()).setWidth(aD.getWidth())).column=aC},hideEditor:function(){var aD=this,aB=aD.editor,aC=aB.column;aD.updatePrompt(aC);aB.setXY([-1000,-1000]);aB.el.un("keydown",aD.onEditorKeyDown,aD).un("blur",aD.hideEditor,aD).blur();!aD.isFocus&&aD.wrap.removeClass("editor-focus")},updatePrompt:function(aB){aB.promptEl.child("div").update(aB.prompt=this.editor.el.dom.value)},focusColumn:function(aD){var aG=this,aE=aG.ua,aF=aE.getScroll().left,aI=0,aC=0,aH=0,aB;k(aG.getColumns(),function(aJ){if(aJ==aD){aC=aJ.width}if(aJ.hidden!==true){if(aJ.lock===true){aH+=aJ.width}else{if(aC==0){aI+=aJ.width}}}});aB=aI+aC;if(aI<aF){aE.scrollTo("left",aI)}else{if((aB-aF)>(aG.width-aH)){aE.scrollTo("left",aB-aG.width+aH+(aE.dom.scrollHeight>aE.dom.clientHeight?16:0))}}},setWidth:function(aB){var aC=this;if(aC.width==aB){return}f.prototype.setWidth.call(aC,aB);aC.syncColumnSize(true)},setHeight:function(aB){var aC=this;if(aC.height==aB){return}aC.height=aB;aC.wb.setHeight(aB-2-aw);aC.fireEvent("resize",aC)},getMinWidth:function(){var aB=this;return aB.lockwidth+f.prototype.getMinWidth.call(aB)},highlightColumn:function(aC,aB){this.unhighlightColumn();aA=aC[aB-1];ax=aC[aB];aA&&aA.promptEl.addClass("grid-highligh-hc");ax&&ax.promptEl.addClass("grid-highligh-r-hc")},unhighlightColumn:function(){aA&&aA.promptEl.removeClass("grid-highligh-hc");ax&&ax.promptEl.removeClass("grid-highligh-r-hc");aA=ax=null},onEditorKeyDown:function(aD){var aB=this,aC=aD.keyCode;if(aC==9||aC==13){aB.showEditorBy(aD.shiftKey);ai(aD)}},onClick:function(aD,aB){aB=t(aB);if(aB.hasClass("grid-hc")||(aB=aB.parent(".grid-hc"))){var aC=this;k(aC.getColumns(),function(aE){if(aE.promptEl==aB){aC.showEditor(aE);return false}})}},onMouseDown:function(aE,aB){var aD=this,aC=aD.wrap;f.prototype.onMouseDown.call(aD,aE,aB);if(aD.isFocus){ai(aE);aB=Ext.fly(aB);if(aC.hasClass("can-split")){aD.onSplitStart(aE)}else{if(aC.hasClass("can-col-resize")){aD.onColumnResizeStart(aE)}else{if(aB.is(".grid-hc")||(aB=aB.parent(".grid-hc"))){aD.onColumnDragStart(aE,aB)}}}}},onMouseMove:function(aC){var aB=this;!d&&aB.wrap[(aB.canSplit(aC))?"addClass":"removeClass"]("can-split")[aB.canColumnResize(aC)?"addClass":"removeClass"]("can-col-resize")},onBlur:function(){var aB=this;f.prototype.onBlur.call(aB)&&aB.wrap.removeClass(["can-split","can-col-resize"])},onColumnDragStart:function(aD,aB){var aC=this;d=true;e=aD.xy;au=aC.getColumns()[aC.wb.select(".grid-hc").indexOf(aB)];Ext.getBody().on("mousemove",aC.onColumnDragMove,aC).on("mouseup",aC.onColumnDragEnd,aC);H="onColumnDragEnd"},onColumnDragMove:function(aD){var aC=this,aB=aC.wrap;if(aD.xy[0]!=e[0]||aD.xy[1]!=e[1]){Ext.getBody().addClass("screen-editor-grid-no-drop");if(aC.canDrop(aD)){aB.addClass("grid-can-drop").removeClass("grid-can-not-drop");aC.highlightColumn(at?aC.lockcolumns:aC.unlockcolumns,az)}else{aC.unhighlightColumn();aB.addClass("grid-can-not-drop")}}},onColumnDragEnd:function(aC){var aB=this;aC!==true&&az!=-1&&aB.drop();d=false;au=null;az=-1;aB.wrap.removeClass(["grid-can-drop","grid-can-not-drop"]);aB.unhighlightColumn();Ext.getBody().removeClass("screen-editor-grid-no-drop").un("mousemove",aB.onColumnDragMove,aB).un("mouseup",aB.onColumnDragEnd,aB)},drop:function(){var aC=this,aB=aC.removeColumn(au);if(au.lock==at&&aB<az){az--}au.lock=at;aC.addColumn(au,az)},onSplitStart:function(aG){var aE=this,aD=aE.wrap,aC=aG.xy[0],aF=aD.getXY(),aH=aF[1],aB=aG.xy[1]-aH;startX=aC-aF[0]+1;aE.spliter.setXY([aC,aH]).setHeight(aB);Ext.getBody().on("mousemove",aE.onSplitMove,aE).on("mouseup",aE.onSplitEnd,aE);d=true;H="onSplitEnd"},onSplitMove:function(aE){var aD=this.wrap,aB=aE.xy[1]-aD.getXY()[1],aC=aD.getHeight();if(aq=aB>=aC){aB=aC}this.spliter.setHeight(aB)},onSplitEnd:function(aC){var aB=this;Ext.getBody().un("mousemove",aB.onSplitMove,aB).un("mouseup",aB.onSplitEnd,aB);aC!==true&&aq&&aB.split(startX);aB.spliter.setXY([-10000,-10000]);d=aq=false},onColumnResizeStart:function(aG){if(ap==-1){return}var aD=this,aE=aD.wb,aB=aG.xy[0],aF=aE.getXY(),aC=aE.getHeight(),aH=aF[1];columnX=0;k(aD.getColumns(),function(aJ,aI){if(aI==ap){return false}else{columnX+=aJ.width}});endX=startX=aB-aF[0]+1;aD.spliter.setXY([aB,aH]).setHeight(aC);Ext.getBody().on("mousemove",aD.onColumnResizeMove,aD).on("mouseup",aD.onColumnResizeEnd,aD);d=true;H="onColumnResizeEnd"},onColumnResizeMove:function(aH){var aE=this,aF=aE.wb,aG=aF.getXY(),aC=aG[0],aD=aE.getColumns(),aB=aD[ap];endX=aH.xy[0]-aC+1;if(aH.ctrlKey||aH.altKey){endX-=endX%((aH.ctrlKey?5:1)*(aH.altKey?10:1))}if(endX<columnX+aE.columnminwidth){endX=columnX+aE.columnminwidth}aE.spliter.setX(endX+aC-1);ae.log("W:"+(endX+aE.ua.getScroll().left)).show(endX+aC-1,aG[1]+aF.getHeight()/2)},onColumnResizeEnd:function(aC){var aB=this;if(endX!=startX&&aC!==true){aB.resizeColumn(endX+aB.ua.getScroll().left)}aB.spliter.setXY([-10000,-10000]);Ext.getBody().un("mousemove",aB.onColumnResizeMove,aB).un("mouseup",aB.onColumnResizeEnd,aB);d=false;ae.hide()},resizeColumn:function(aB){var aC=this;k(aC.getColumns(),function(aE,aD){if(aD==ap){aE.hl.setWidth(aE.width=aB);aC.syncColumnSize(aE.lock);return false}else{aB-=aE.width}})},split:function(aB){var aD=this,aC=0;k(aD.getColumns(),function(aF,aE){aC+=aF.width});aD.createColumn(aB-aC)},showLockArea:function(){var aB=this;aB.lockcolumns.push(au);aB.la.setStyle({display:""});aB.syncColumnSize(true);aB.lockcolumns=[];aB.isShowLockArea=true},hideLockArea:function(){var aB=this;if(aB.isShowLockArea){aB.la.setStyle({display:"none"});aB.syncColumnSize(true);aB.isShowLockArea=false}},canDrop:function(aE){var aD=this,aC=aD.wrap,aB=aE.xy[0]-aC.getXY()[0];columns=aD.getColumns(),lockcolumns=aD.lockcolumns,dragIndex=columns.indexOf(au),ret=false;w=0;az=-1;if(aB<0){if(!lockcolumns.length){aD.showLockArea()}else{if(au==columns[0]){return ret}}az=0;at=true;ret=true}else{if(!lockcolumns.length){aD.hideLockArea()}at=aB<aD.lockwidth;k(columns,function(aH,aG){var aF=aH.width/2;w+=aF;if(aB<w){az=aG;ret=true;return false}w+=aF});if(!ret){az=columns.length;ret=true}if(au.lock==at&&(dragIndex==az||dragIndex==az-1)){ret=false;az=-1}if(ret){if(az<lockcolumns.length){at=true}else{if(az>lockcolumns.length||!at){az-=lockcolumns.length;at=false}}}}return ret},canSplit:function(aG){var aF=this,aE=aF.wrap,aC=aE.getWidth(),aB=aG.xy[0]-aE.getXY()[0],aD=false;if(aB>aF.columnminwidth){aD=true;aC=0;k(aF.getColumns(),function(aI,aH){aC+=aI.width;if(aB>aC+aF.columnminwidth){aD=true}else{return aD=false}})}return aD},canColumnResize:function(aI){var aG=this,aE=aI.target,aF=aG.wrap;if(!aG.uh.contains(aE)&&!aG.lh.contains(aE)){return false}var aC=-aG.ua.getScroll().left,aH=aG.wb.getXY(),aB=aI.xy[0]-aH[0],aD=false;ap=-1;k(aG.getColumns(),function(aK,aJ){aC+=aK.width;if(aB<aC+5&&aB>aC-5){aD=true;ap=aJ;return false}});return aD},destroy:function(){f.prototype.destroy.call(this);this.editor.remove()}})}(),TabPanel:function(){var aq=-1,ar=['<div class="strip"  unselectable="on" onselectstart="return false;">','<div class="strip-left"></div>','<div style="width:{stripwidth}px;" class="strip-center">{title}<div class="tab-close"></div></div>','<div class="strip-right"></div>',"</div>"],au='<div class="tab"><table cellspacing="0" cellpadding="0"><tbody><tr></tr></tbody></table></div>',at=['<div tabIndex="0" hideFocus class="tab-editor editor-wrap can-drop" style="width:{width}px;height:{height}px;">','<table cellSpacing="0" cellPadding="0" border="0" class="item-tab">',"<tbody>","<tr>","<td>",'<div atype="scroll-left" class="tab-scroll tab-scroll-left scroll-disabled" style="display:none"></div>','<div class="item-tab-strip" style="overflow:hidden;width:{headwidth}px">','<div class="clearfix" atype="tab.strips" style="border-bottom:1px solid #cccccc"><div class="item-tab-add">+</div></div>',"</div>",'<div atype="scroll-right" class="tab-scroll tab-scroll-right" style="display:none"></div>',"</td>","</tr>","<tr>",'<td style="padding-right:2px">','<div class="item-tab-body" style="height:{bodyheight}px;"></div>',"</td>","</tr>","</tbody>","</table>","<div>"],av='<td style="padding:8px 0 0 8px"></td>',ap=Ext.extend(an,{type:"Tab",initComponent:function(aw){var ax=this;ax.strip=new Ext.Template(ar).append(ax.head,{stripwidth:ax.stripwidth-6,title:ax.title||""},true);ax.body=(ax.wrap=new Ext.Template(au).append(ax.wrapbody,{},true)).child("table");ax.children=[]},createEmptyTd:function(aw){return new Ext.Template(av).append(aw,{},true)},showProxy:function(ax,aw){var ay=this;P.height(aw.height).width(aw.width).show(ax).on("hide",ay.onProxyHide,ay)},onProxyHide:function(){var aw=this;P.getWrap().parent().remove();delete aw.dropIndex;P.un("hide",aw.onProxyHide,aw)},redraw:function(ay){var aB=this,ax=aB.body,aD=ax.child("tbody"),aw=S.createElement("tbody"),aA=aB.children,az,aC=0;ax.dom.appendChild(aw);if(ay){az=J(I);aA.splice(aq,0,az)}k(aA,function(aH){var aF=t(aw.insertRow(-1)),aG=aB.createEmptyTd(aF);if(aH===az){aB.showProxy(aG,az)}else{var aE=aH.wrap;if(aE.is("td")){aE=aE.parent("table")}aE.appendTo(aG)}});ay&&aA.remove(az);aD.remove()},add:function(az,aw){var ay=this,ax=ay.children.indexOf(az);if(ax==aw){return}else{if(ax!=-1){ay.onChildRemove(az)}}ay.pushChild(az,aw);az.on("drag",ay.onChildRemove,ay);az.on("destroy",ay.onChildRemove,ay);ay.redraw();az.focus();P.un("hide",ay.onProxyHide,ay);P.hide()},create:function(aw,ax){var aA=this,az=G.get(aw.get(g));if(!az){return}var ay=new ad[az](U({},p(aw),x.get(az)));aA.add(ay,ax);return ay},onChildRemove:function(aB){var ax=this,aA=aB.previousSibling,ay=aB.nextSibling,az=ax.children,aw=az.indexOf(aB);az.splice(aw,1);if(aA){aA.nextSibling=ay}if(ay){ay.previousSibling=aA}delete aB.previousSibling;delete aB.nextSibling;aB.un("destroy",ax.onChildRemove,ax);aB.un("drag",ax.onChildRemove,ax);ax.redraw()},pushChild:function(ay,aD){var aC=this,az=aC.children,aG=az[aD-1],ax=az[aD],aF;az.splice(aD,0,ay);if(aG){ay.previousSibling=aG;aG.nextSibling=ay}if(ax){ax.previousSibling=ay;ay.nextSibling=ax}aF=ay.getRecord();while(ax){var aH=ax.getRecord(),aE=aH.get(Z),aB=aF.get(Z);if(aB<aE){ax=null}else{aH.set(Z,aB- -1);aF=ax.getRecord();ax=ax.nextSibling}}aF=ay.getRecord();while(aG){var aw=aG.getRecord(),aA=aw.get(Z),aB=aF.get(Z);if(aB>aA){aG=null}else{aw.set(Z,aB-1);aF=aG.getRecord();aG=aG.previousSibling}}},active:function(){this.strip.addClass("active");this.wrap.setStyle({left:"0",top:"0"})},unactive:function(){this.strip.removeClass("active");this.wrap.setStyle({left:"",top:""})},setWidth:function(aw){var ax=this;if(aw==ax.width){return}ax.width=aw;ax.fireEvent("resize",ax)},setHeight:function(aw){var ax=this;if(aw==ax.height){return}ax.height=aw;ax.fireEvent("resize",ax)},setStripWidth:function(aw){var ax=this;if(aw==ax.stripwidth){return}ax.stripwidth=aw;ax.strip.child(".strip-center").setWidth(aw-6);ax.fireEvent("stripresize",ax)},getStripWidth:function(){return this.stripwidth},focus:function(){var aw=this,ax=aw.dataset;ax.locate(ax.indexOf(aw.getRecord())+1,false)}});return Ext.extend(f,{type:"TabPanel",initComponent:function(aw){var aA=this,az=aA.wrap=new Ext.Template(at).append(D,{width:aA.width,height:aA.height,headwidth:aA.width-38,bodyheight:aA.height-29},true),ay=aA.head=az.child("div[atype=tab.strips]"),ax=aA.stripwrap=ay.parent();aA.body=az.child(".item-tab-body");aA.scrollLeft=az.child("div[atype=scroll-left]");aA.scrollRight=az.child("div[atype=scroll-right]");aA.addBtn=az.child(".item-tab-add");aA.children=[];aA.id+="-tabpanel";F[aA.group]=aA;aA.selectTab(aA.create(aA.record));delete aA.record},processListener:function(aw){var ax=this;f.prototype.processListener.call(ax,aw);ax.stripwrap[aw]("mousewheel",ax.onHeadMouseWheel,ax).parent()[aw]("mousedown",ax.onHeadMouseDown,ax);ax.addBtn[aw]("click",ax.onAdd,ax);T[aw](ax.onDrag,ax)},getRecord:function(){return this.children[0].getRecord()},onClose:function(){var aw=this,ax=aw.dataset;k([].concat(aw.children),function(ay){ax.remove(ay.getRecord())})},onAdd:function(){var aw=this,ax=Ext.apply({},aw.children[0].getRecord().data);ax[l]="editor-"+(++al);ax[Z]=aw.children.length;ax[ah]="";aw.dataset.create(ax)},create:function(aw,ax){var az=this,ay=new ap(U({head:az.head,wrapbody:az.body,panel:az},p(aw),x.get("Tab")));az.add(ay,isNaN(ax)?az.children.length:ax);return ay},add:function(az,aw){var ay=this,ax=ay.children.indexOf(az);if(ax==aw){return}else{if(ax!=-1){ay.onChildRemove(az)}}ay.pushChild(az,aw);az.on("destroy",ay.onChildRemove,ay);az.on("drag",ay.onChildRemove,ay);ay.redraw();az.focus();P.un("hide",ay.onProxyHide,ay);P.hide()},add:function(ax,aw){var ay=this;ay.pushChild(ax,aw);ax.on("stripresize",ay.onTabStripResize,ay);ax.on("destroy",ay.onTabRemove,ay);ax.fireEvent("stripresize")},pushChild:function(ay,aD){var aC=this,az=aC.children,aG=az[aD-1],ax=az[aD],aF;az.splice(aD,0,ay);if(aG){ay.previousSibling=aG;aG.nextSibling=ay}if(ax){ax.previousSibling=ay;ay.nextSibling=ax}aF=ay.getRecord();while(ax){var aH=ax.getRecord(),aE=aH.get(Z),aB=aF.get(Z);if(aB<aE){ax=null}else{aH.set(Z,aB- -1);aF=ax.getRecord();ax=ax.nextSibling}}aF=ay.getRecord();while(aG){var aw=aG.getRecord(),aA=aw.get(Z),aB=aF.get(Z);if(aB>aA){aG=null}else{aw.set(Z,aB-1);aF=aG.getRecord();aG=aG.previousSibling}}},selectTab:function(aw){var ay=this,ax=isNaN(aw)?aw:ay.children[aw];if(ay.currentTab){ay.currentTab.unactive()}ay.currentTab=ax;ax.active();ax.focus()},findTabById:function(ax){var aw;k(this.children,function(ay){if(ay.id==ax){aw=ay;return false}});return aw},onDrag:function(){var aw=this;aw.wrap.on("mousemove",aw.onDragOver,aw).on("mouseleave",aw.onDragLeave,aw).on("mouseup",aw.onDrop,aw);Ext.getBody().addClass("screen-editor-item-no-drop")},onDragOver:function(az,ax){ax=t(ax);var ay=this;if(ax.is(".strip")||(ax=ax.parent(".strip"))){ay.selectTab(ax.parent().select(".strip").indexOf(ax))}else{var aw=az.xy[0],aA=az.xy[1];ae.isShow()&&ae.show(aw+ae.width()/2+20,aA+ae.height()/2+20,false);N.start(function(){var aE=ay.currentTab,aC=aE.children,aB=aA-ay.body.getXY()[1],aD=0;aq=-1;k(aC,function(aH,aG){var aF=aH.getHeight()/2;aD+=aF;if(aB<aD){aq=aG;return false}else{aD+=aF}});if(aq==-1){aq=aC.length}if(aE.dropIndex!=aq){if(P.isShow()){P.hide()}aE.dropIndex=aq;aE.redraw(true)}},50)}ai(az)},onDragLeave:function(ax,aw){N.end();P.hide()},onDrop:function(aC,ay){var aB=this,az=aB.currentTab;N.end();if(P.isShow()){if(Ext.isString(I)){aB.dataset.create(z(I,aq,az.id),aq)}else{var aA=I.getRecord(),ax=aA.get(B),aw=aA.get(Z);if(ax==az.id&&aw==aq){I.cancelDrag();ai(aC);return}aA.set(B,az.id);aA.set(Z,aq)}}r.fire();ai(aC)},onDropEnd:function(){var aw=this;f.prototype.onDropEnd.call(aw);aw.wrap.un("mousemove",aw.onDragOver,aw).un("mouseleave",aw.onDragLeave,aw).un("mouseup",aw.onDrop,aw);Ext.getBody().un("mouseup",aw.onItemListMouseUp,aw).removeClass("screen-editor-item-no-drop");I=null;delete aw.currentTab.dropIndex},onHeadMouseWheel:function(aw){var ax=aw.getWheelDelta();if(ax>0){this.scrollTo("left");ai(aw)}else{if(ax<0){this.scrollTo("right");ai(aw)}}},onHeadMouseDown:function(aB,ax){var az=t(ax),ay=az.parent(".strip"),aA=this;if(az.hasClass("tab-close")){az.removeClass("tab-btn-over").addClass("tab-btn-down")}else{if(az.hasClass("tab-scroll")&&!az.hasClass("scroll-disabled")){function aw(){if(az===aA.scrollLeft){aA.scrollTo("left")}else{aA.scrollTo("right")}}aw();Ext.getBody().on("mouseup",aA.stopScroll,aA);aA.scrollInterval=setInterval(function(){if(az.hasClass("tab-scroll")&&!az.hasClass("scroll-disabled")){aw()}else{aA.stopScroll()}},100)}else{if(ay&&ay.hasClass("strip")&&!ay.hasClass("active")&&!ay.hasClass("scroll-disabled")){aA.selectTab(ay.parent().select(".strip").indexOf(ay))}}}},stopScroll:function(){var aw=this;if(aw.scrollInterval){clearInterval(aw.scrollInterval);delete aw.scrollInterval}Ext.getBody().un("mouseup",aw.stopScroll,aw)},scrollTo:function(az){var aB=this,aA=aB.stripwrap,ay=aB.scrollRight,aC=aB.scrollLeft,ax=aA.getScroll().left,aw=x.get("Tab").stripwidth;if(az=="left"){aA.scrollTo("left",ax-aw);ay.removeClass("scroll-disabled");if(aA.getScroll().left<=0){aC.addClass("scroll-disabled").replaceClass("tab-scroll-left-over","tab-scroll-left");aB.stopScroll()}}else{if(az=="right"){aA.scrollTo("left",ax+aw);aC.removeClass("scroll-disabled");if(aA.getScroll().left+aA.getWidth()>=aB.head.getWidth()){ay.addClass("scroll-disabled").replaceClass("tab-scroll-right-over","tab-scroll-right");aB.stopScroll()}}}},onTabRemove:function(ay){var az=this,ax=az.children,aw=ax.indexOf(ay);ax.splice(aw,1);ay.un("stripresize",az.onTabStripResize,az);ay.un("destroy",az.onTabRemove,az);if(!ax.length){az.destroy()}},onTabStripResize:function(){var ax=this,aw=27;k(ax.children,function(ay){aw+=ay.getStripWidth()});ax.head.setWidth(aw);ax.refreshScrollStatus()},refreshScrollStatus:function(){var aC=this,aB=aC.head,aA=aC.stripwrap,aD=aC.scrollLeft,az=aC.scrollRight;if(aA.getWidth()<aB.getWidth()){aD.setStyle({display:""});az.setStyle({display:""});aA.setStyle("padding-left","1px");var ay=aA.getScroll().left,ax=aA.getWidth(),aw=aB.getWidth();aD[ay<=0?"addClass":"removeClass"]("scroll-disabled");if(ay+ax>=aw){if(!az.hasClass("scroll-disabled")){az.addClass("scroll-disabled")}else{aA.scrollTo("left",aw-ax)}}else{az.removeClass("scroll-disabled")}}else{aD.setStyle({display:"none"});az.setStyle({display:"none"});aA.setStyle("padding-left","0").scrollTo("left",0)}},setWidth:function(aw){var ay=this;if(f.prototype.setWidth.call(ay,aw)!=false){var ax=ay.stripwrap;ax.setWidth(aw-38);ay.refreshScrollStatus();k(ay.children,function(az){az.getRecord().set(Q,aw)})}},setHeight:function(aw){var ax=this;if(f.prototype.setHeight.call(ax,aw)!=false){ax.body.setHeight(aw-27);k(ax.children,function(ay){ay.getRecord().set(W,aw)})}},setupWidth:function(ax){var aw=this;if(f.prototype.setupWidth.call(aw,ax)!=false){k(aw.children,function(ay){ay.getRecord().set(v,ax)})}},setupHeight:function(ax){var aw=this;if(f.prototype.setupHeight.call(aw,ax)!=false){k(aw.children,function(ay){ay.getRecord().set(s,ax)})}}})}()};ad.Table=function(){return Ext.extend(ad.Grid,{type:"Table"})}();$A.ScreenEditor=function(){var ap=-1,au='<td style="padding:{padding}px"></td>',aq='<div class="hidden-element"></div>',ar=['<table cellpadding="0" cellspacing="0" class="hidden-element">',"<tr>",'<th class="layout-th" width="10">',"<div></div>","</th>","</tr>","</table>"],at=function(aw,av){aw.children.sort(at);av.children.sort(at);return aw.record.get(Z)-av.record.get(Z)};return Ext.extend($A.Component,{constructor:function(av){var aw=this;X=av.theme;aw.children=[];ae.init();P.init();x.init();if(!D){D=new Ext.Template(aq).insertFirst(Ext.getBody())}if(!L){L=new Ext.Template(ar).insertFirst(Ext.getBody(),{},true).child("div")}$A.ScreenEditor.superclass.constructor.call(aw,av);aw.resolutionslider.setValue(aw.screenresolution)},initComponent:function(av){var aw=this;$A.ScreenEditor.superclass.initComponent.call(aw,av);aw.editorItemList=aw.wrap.child(".screen-editor-item-list");aw.screenBody=(aj=aw.wrap.child(".screen-editor-screen-wrap")).child(".screen-body");aw.menubar=aw.wrap.child(".editor-menubar");Ext.isIE&&Ext.getBody().addClass("old-ie");aw.resolutionslider=$(aw.id+"_slider")},bind:function(ax,av){if(Ext.isString(ax)){ax=$(ax);if(!ax){return}}if(Ext.isString(av)){av=$(av);if(!av){return}}var aw=this;O=ax;h=av;aw.processDataSetLiestener("on");$A.onReady(function(){aw.onLoad()})},processListener:function(av){var aw=this;$A.ScreenEditor.superclass.processListener.call(aw,av);aw.resolutionslider[av]("change",aw.onResolutionChange,aw);aw.editorItemList[av]("mousedown",aw.onItemListMouseDown,aw);aw.menubar[av]("click",aw.onMenuClick,aw)[av]("mousedown",aw.onMenuMouseDown,aw);T[av](aw.onDrag,aw);r[av](aw.onDropEnd,aw)},processDataSetLiestener:function(av){var aw=this,ax=O;if(ax){ax[av]("update",aw.onUpdate,aw);ax[av]("add",aw.onAdd,aw);ax[av]("load",aw.onLoad,aw);ax[av]("remove",aw.onRemove,aw);ax[av]("indexchange",aw.onIndexChange,aw)}},initEvents:function(){this.addEvents("drop");this.processListener("on")},onAdd:function(ay,av,aw){var az=av.get(b),ax=(az?F[az]:af.get(av.get(B)))||this;ax.create(av,aw)},onRemove:function(ax,av){var aw=af.get(av.get(l));aw.destroy()},onUpdate:function(aA,av,aw,az,aB){var ay=af.get(av.get(l));if(ay.type=="Tab"){ay=ay.panel}switch(aw){case l:var ay=af.get(aB);af.remove(ay);ay.id=az;af.put(ay);k(ay.children,function(aC){aC.getRecord().set(B,az)});break;case Q:av.set(V,o-az);ay.setWidth(az);break;case W:av.set(K,i-az);ay.setHeight(az);break;case V:av.set(Q,o-az);break;case K:av.set(W,i-az);break;case v:ay.setupWidth(az);break;case s:ay.setupHeight(az);break;case a:ay.setFieldWidth(az);break;case Y:ay.setLabelWidth(az);break;case j:case M:ay.refreshSize&&ay.refreshSize(av.get(j),av.get(M));break;case B:case Z:var ax=af.get(av.get(B))||this;ax.add(ay,av.get(Z));break}},clear:function(){af.clear();F={};this.children=[];this.redraw()},onLoad:function(){var az=this,av=O.getAll();az.clear();if(av.length){var aB={},aA={},aC=[];k(av,function(aD){var aE=aD.get(l);aB[aE]=aA[aE]={record:aD,children:[]}});for(var aw in aA){var ay=aA[aw],ax=aA[ay.record.get(B)];if(ax){ax.children.push(ay);delete aB[aw]}}for(var aw in aB){aC.push(aA[aw])}aC.sort(at);az.createElements(aC,az)}},onIndexChange:function(az,ay){var ax=G.get(ay.get(g));if(ax=="TabPanel"){var aA=ay.get(b),av=F[aA];if(av){av.selectTab(av.findTabById(ay.get(l)))}}else{var aw=af.get(ay.get(l));aw&&aw.focus()}},createElements:function(av,ax){var ay=this,aw=0;k(av,function(aB){var az=aB.record,aA;if(az.get("enabled_flag")=="Y"){aA=ax.create(az,aw++);if(aA.type=="TabPanel"){ax=aA;aA=aA.currentTab}ay.createElements(aB.children,aA)}})},onMenuClick:function(aw,av){av=Ext.fly(av);if(av.hasClass("ico-menu-collapse")){am.setStyle({display:""}).parent(".editor-menu-button").removeClass("selected")}else{if((av.hasClass("editor-menu-button")||(av=av.parent(".editor-menu-button")))&&!av.hasClass("selected")){am&&am.setStyle({display:""}).parent(".editor-menu-button").removeClass("selected");if(am=av.child(".editor-menu-view")){av.addClass("selected");am.setStyle({display:"block"})}}}},onMenuMouseDown:function(az,aD){aD=Ext.fly(aD);if(aD.parent(".editor-menu-can-move")||aD.is(".editor-menu-can-move")){var aw=this,aB=am,aE=aB.getXY(),av=az.xy,aA=av[0]-aE[0],ax=av[1]-aE[1],aC=function(aF){aB.moveTo(aF.xy[0]-aA,aF.xy[1]-ax)},ay=function(){Ext.getBody().un("mousemove",aC,aw).un("mouseup",ay,aw)};Ext.getBody().on("mousemove",aC,aw).on("mouseup",ay,aw)}},onResolutionChange:function(aw,av){this.setScreenSize(av)},onDrag:function(){var av=this;aj.on("mousemove",av.onDragOver,av).on("mouseleave",av.onDragLeave,av).on("mouseup",av.onDrop,av);Ext.getBody().addClass("screen-editor-item-no-drop")},onDragOver:function(ay,aw){var ax=this,av=ay.xy[0],az=ay.xy[1];ae.isShow()&&ae.show(av+ae.width()/2+20,az+ae.height()/2+20,false);N.start(function(){var aB=ax.children,aA=az-aj.getXY()[1],aC=0;ap=-1;k(aB,function(aF,aE){var aD=aF.getHeight()/2;aC+=aD;if(aA<aC){ap=aE;return false}else{aC+=aD}});if(ap==-1){ap=aB.length}if(ax.dropIndex!=ap){if(P.isShow()){P.hide()}ax.dropIndex=ap;ax.redraw(true)}},50)},redraw:function(aw){var az=this,aB=az.screenBody.child("tbody"),av=S.createElement("tbody"),ay=az.children,ax,aA=0;az.screenBody.dom.appendChild(av);if(aw){ax=J(I,true);ay.splice(ap,0,ax)}k(ay,function(aF){var aD=t(av.insertRow(-1)),aE=az.createEmptyTd(aD);if(aF===ax){az.showProxy(aE,ax)}else{var aC=aF.wrap;if(aC.is("td")){aC=aC.parent("table")}aC.appendTo(aE)}});aw&&ay.remove(ax);aB.remove()},createEmptyTd:function(av){return new Ext.Template(au).append(av,{padding:3},true)},showProxy:function(aw,av){var ax=this;P.height(av.height).width(av.width).show(aw).on("hide",ax.onProxyHide,ax)},onProxyHide:function(){P.getWrap().parent().remove();delete this.dropIndex;P.un("hide",this.onProxyHide,this)},onDragLeave:function(aw,av){N.end();P.hide()},onDrop:function(aA,ax){var az=this;N.end();if(P.isShow()){if(Ext.isString(I)){O.create(z(I,ap),ap)}else{var ay=I.getRecord(),aw=ay.get(B),av=ay.get(Z);if(Ext.isEmpty(aw)&&av==ap){I.cancelDrag();ai(aA);return}ay.set(B,"");ay.set(Z,ap)}}r.fire();ai(aA)},onDropEnd:function(){var av=this;aj.un("mousemove",av.onDragOver,av).un("mouseleave",av.onDragLeave,av).un("mouseup",av.onDrop,av);Ext.getBody().un("mouseup",av.onItemListMouseUp,av).removeClass("screen-editor-item-no-drop");I=R=null;delete av.dropIndex},onItemListMouseDown:function(ax,av){var aw=this;av=t(av);if(av.is(".screen-editor-item")){I=av.getAttributeNS("","data-type");R=av.parent("ul").getAttributeNS("","data-category");Ext.getBody().on("mouseup",aw.onItemListMouseUp,aw);T.fire()}},onItemListMouseUp:function(){r.fire()},onChildRemove:function(aA){var aw=this,az=aA.previousSibling,ax=aA.nextSibling,ay=aw.children,av=ay.indexOf(aA);aA.ref={array:ay,index:av,owner:aw};ay.splice(av,1);if(az){az.nextSibling=ax}if(ax){ax.previousSibling=az}delete aA.previousSibling;delete aA.nextSibling;aw.redraw();aA.un("destroy",aw.onChildRemove,aw);aA.un("drag",aw.onChildRemove,aw)},create:function(av,aw){var az=this,ay=G.get(av.get(g));if(!ay){return}var ax=new ad[ay](U({},p(av),x.get(ay)));az.add(ax,aw);return ax},add:function(ay,av){var ax=this,aw=ax.children.indexOf(ay);if(aw==av){return}else{if(aw!=-1){ax.onChildRemove(ay)}}ax.pushChild(ay,av);ay.on("destroy",ax.onChildRemove,ax);ay.on("drag",ax.onChildRemove,ax);ax.redraw();ay.focus();P.un("hide",ax.onProxyHide,ax);P.hide()},pushChild:function(ax,aC){var aB=this,ay=aB.children,aF=ay[aC-1],aw=ay[aC],aE;ay.splice(aC,0,ax);if(aF){ax.previousSibling=aF;aF.nextSibling=ax}if(aw){aw.previousSibling=ax;ax.nextSibling=aw}aE=ax.getRecord();while(aw){var aG=aw.getRecord(),aD=aG.get(Z),aA=aE.get(Z);if(aA<aD){aw=null}else{aG.set(Z,aA- -1);aE=aw.getRecord();aw=aw.nextSibling}}aE=ax.getRecord();while(aF){var av=aF.getRecord(),az=av.get(Z),aA=aE.get(Z);if(aA>az){aF=null}else{av.set(Z,aA-1);aE=aF.getRecord();aF=aF.previousSibling}}},setScreenSize:function(aw){var av=aw.split("*");aj.setStyle({width:(o=Number(av[0]))-20+"px",height:(i=Number(av[1]))-10+"px"});y.fire(o,i)}})}();$A.SliderBar=Ext.extend($A.Component,{initComponent:function(ap){var at=this;$A.SliderBar.superclass.initComponent.call(at,ap);var ar=at.wrap,aq=at.options;at.calib=ar.child(".slider-bar-calib");at.itemlist=ar.child(".slider-bar-items");at.tria=ar.child(".slider-tria");at.slider=ar.child(".slider");if(aq){at.setOptions(aq)}else{at.clearOptions()}},processListener:function(ap){var aq=this;$A.SliderBar.superclass.processListener.call(aq,ap);aq.wrap[ap]("mousedown",aq.onMouseDown,aq)},processDataSet:function(ap){var aq=this,ar=aq.optionDataSet,at=aq.render;if(ar){ar[ap]("load",at,aq);ar[ap]("query",at,aq);ar[ap]("add",at,aq);ar[ap]("update",at,aq);ar[ap]("remove",at,aq);ar[ap]("clear",at,aq);ar[ap]("reject",at,aq)}},onMouseDown:function(ar,ap){var aq=this;ap=Ext.fly(ap);if(ap.hasClass("slider")){aq.onSliderDown()}else{if(ap.hasClass("slider-bar-calib")||ap.parent(".slider-bar-calib")){aq.onSliderMove(ar)}}},onSliderDown:function(){var ap=this;ap.slider.addClass("selected");Ext.getBody().on("mousemove",ap.onSliderMove,ap).on("mouseup",ap.onSliderUp,ap)},onSliderMove:function(at){var aq=this,ar=aq.optionDataSet;if(ar){var ap=ar.getAll();aq.setValue(ap[A(ak(0,ao((at.xy[1]-aq.wrap.getY()-12)/24)),ap.length-1)].get(aq.valuefield))}},onSliderUp:function(){var ap=this;ap.slider.removeClass("selected");Ext.getBody().un("mousemove",ap.onSliderMove,ap).un("mouseup",ap.onSliderUp,ap)},setOptions:function(ap){var aq=this,ar=typeof(ap)==="string"?$(ap):ap;if(aq.optionDataSet!=ar){aq.processDataSet("un");aq.optionDataSet=ar;aq.processDataSet("on");aq.render();if(!Ext.isEmpty(aq.value)){aq.setValue(aq.value,true)}}},clearOptions:function(){var ap=this;ap.processDataSet("un");ap.optionDataSet=null;ap.clear()},clear:function(){var ap=this;ap.calib.update("");ap.itemlist.update("")},render:function(){var ar=this,at=ar.optionDataSet,ap=at.getAll(),aq=ap.length,au=ar.displayfield;ar.calib.update(Array(aq).join("<li></li>"));ar.itemlist.update(ap.map(function(aw,av){return"<li"+(function(){switch(av){case 0:case aq-1:case ao((aq-1)/2):return' class="strong">';default:return">"}})()+aw.get(au)+"</li>"}).join(""));ar.tria.setStyle({"border-bottom-width":24*aq-24+"px"})},positionSlider:function(ap){var aq=this;if(aq.selectIndex){aq.itemlist.select("li:nth-child("+(aq.selectIndex+1)+")").removeClass("selected")}aq.selectIndex=ap;aq.itemlist.select("li:nth-child("+(ap+1)+")").addClass("selected");aq.slider.setStyle({top:24*ap+"px"})},setValue:function(aq,ap){if(this.value==aq){return}var ar=this,at=ar.optionDataSet;$A.SliderBar.superclass.setValue.call(this,aq,ap);if(at){ar.positionSlider(at.indexOf(at.find("value",aq)))}}})})();